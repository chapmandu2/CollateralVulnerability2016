#!/usr/bin/env ruby
#use genes "WBGene00000003,WBGene00008571,WBGene00002176,WBGene00004063,WBGene00000089,WBGene00022358"

require "rubygems"
require "intermine/service"

input = ARGV[0]
genes = input.chomp.split(",")
#print genes

service = Service.new("http://im-dev.wormbase.org/tools/wormmine")

# Get a new query from the service you will be querying:
fields = ["primaryIdentifier", "symbol", "secondaryIdentifier", "briefDescription", "alleles.symbol", "alleles.phenotypesObserved.identifier", "alleles.phenotypesObserved.name", "alleles.phenotypesObserved.description"]
fields.each { |field| print field, "\t"}
puts "\n"

service.new_query("Gene").
select(fields).
# You can edit the constraint values below
where("Gene.primaryIdentifier" => genes).
where("Gene.alleles.phenotypesObserved.name" => {:contains => "lethal"}).
order_by("primaryIdentifier", "ASC").
#limit(10).

#now output data

each_row { |r| puts r.to_csv}

