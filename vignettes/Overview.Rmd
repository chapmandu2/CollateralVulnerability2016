---
title: "Collateral Vulnerability Overview Vignette"
author: "Phil Chapman"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo=FALSE, message=FALSE}
library(CollateralVulnerability2016)
library(dplyr)
```

## Introduction

## Step 1: Set up SQLite database and directories
```{r eval=TRUE}
work_dir <- '~/BigData/CollateralVulnerability2016/skcm/'
download_dir <- '~/BigData/RTCGA_downloads/'
mydb <- 'skcm_output.db'
mydb_path <- paste0(work_dir, mydb)
my_con <- setupSQLite ( mydb_path ) 

```

## Step 2: Get human geneset to work with
In this case we want all human genes using the most recent ENSEMBL annotation:
```{r eval=TRUE}
all_genes <- getAllHumanGenes(my_con)
head(all_genes)

```
Gene data also written to SQLite database and can be viewed with dplyr:
```{r eval=TRUE}
src_sqlite(my_con@dbname) %>% tbl('human_genes')
```
## Step 3: Import TCGA RNAseq data
Want to import the TCGA RNAseq data so that it is ready to use for further analyses
```{r eval=FALSE}

rnaseq_dat <- getTCGARNAseqData(my_con, cancerTypes='SKCM', releaseDate = '2015-11-01', sampletag=c('01A', '06A'))
dim(rnaseq_dat)
DBI::dbListTables(my_con)

```
## Step 4: Run the low expressors analysis on RNAseq data
Use just 1000 randomly selected genes for this analysis rather than the whole set.  
Analysis takes several minutes to run even with parallel processing
```{r eval=TRUE}

bisep_output <- doBISEPAnalysis(my_con, genes_n=1000)

```
    
    
## Step 5: View the results of the low expressors analysis
```{r eval=TRUE}

src_sqlite(my_con@dbname) %>% tbl('bisep_results') %>% dplyr::filter(PI) %>% arrange(V2)

```

## Step 6: Generate a plot for a given gene

```{r eval=TRUE}
doRNAseqPlot(my_con, 'ENSG00000157764')

```


## Step 7:  View the BISEP output as a shiny app

